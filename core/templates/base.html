{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=1440">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="{% static 'style.css' %}">
	<link rel="shortcut icon" href="{% static 'img/favicon.ico' %}" type="image/x-icon">
	<style>
		#snackbar {
		  visibility: hidden;
		  min-width: 250px;
		  margin-left: -125px;
		  text-align: center;
		  border-radius: 2px;
		  padding: 16px;
		  position: fixed;
		  z-index: 1;
		  left: 50%;
		  bottom: 80px;
		  font-size: 17px;
		}

		#snackbar.dark {
			background-color: #F1F1F1;
		  	color: #323232;
		}

		#snackbar.light {
			background-color: #242424;
		  	color: #E9E9E9;
		}
		
		#snackbar.show {
		  visibility: visible;
		  -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
		  animation: fadein 0.5s, fadeout 0.5s 2.5s;
		}
		
		@-webkit-keyframes fadein {
		  from {bottom: 0; opacity: 0;} 
		  to {bottom: 30px; opacity: 1;}
		}
		
		@keyframes fadein {
		  from {bottom: 0; opacity: 0;}
		  to {bottom: 30px; opacity: 1;}
		}
		
		@-webkit-keyframes fadeout {
		  from {bottom: 30px; opacity: 1;} 
		  to {bottom: 0; opacity: 0;}
		}
		
		@keyframes fadeout {
		  from {bottom: 30px; opacity: 1;}
		  to {bottom: 0; opacity: 0;}
		}
	</style>
	{% block style %} {% endblock style %}
    <title>{% block title %} {% endblock title %}</title>
</head>

<body>
	<div class="wrapper dark">
		<div id="popup" class="popup auth-popup" {% if login_form.errors or register_form.errors %} style="display: block;" {% endif %}>
			<div class="popup-content dark d-flex flex-column" style="width: 540px;">
				<div class="d-flex justify-content-between" style="margin-bottom: 20px;">
					<button class="auth_tab {% if login_form.errors %} {% else %} active dark {% endif %}" onclick="openTab(this)">Регистрация</button>
					<button class="auth_tab {% if login_form.errors %} active dark {% endif %}" onclick="openTab(this)">Войти</button>
				</div>
				<form action="{% url 'signup' %}" method="post" class="signup" {% if login_form.errors %} style="display: none;" {% else %} style="display: flex; flex-direction: column;" {% endif %}>
                    {% csrf_token %}
                    {{ register_form.spec }}
                    {{ register_form.spec.errors }}
                    <div class="form-group">
						{{ register_form.fullName }}
						<label for="fullName">ФИО</label>
					</div>
                    {{ register_form.fullName.errors }}
                    <div class="form-group">
						{{ register_form.phone }}
						<label for="phone">Номер телефона</label>
					</div>
                    {{ register_form.phone.errors }}
                    <div class="form-group">
						{{ register_form.email }}
						<label for="email">E-mail</label>
					</div>
                    {{ register_form.email.errors }}
					<button class="button-1 dark" style="font-weight: 600; border-radius: 8px; padding: 10px 0px;" type="submit">Зарегистрироваться</button>
				</form>
				<form action="{% url 'login_view' %}" method="post" class="signin" {% if login_form.errors %} style="display: flex; flex-direction: column;" {% else %} style="display: none;" {% endif %}>
                    {% csrf_token %}
					<div class="form-group">
						{{ login_form.username }}
						<label for="username">E-mail</label>
					</div>
					<div class="form-group">
						{{ login_form.password }}
						<label for="password">Пароль</label>
					</div>
                    {{ login_form.password.errors }}
					<button class="button-1 dark" style="font-weight: 600; border-radius: 8px; padding: 10px 0px;" type="submit">Войти</button>
				</form>
			</div>
		</div>
        <div id="popup" class="popup works-popup">
			<div class="popup-content dark d-flex flex-column" style="width: 1000px;">
				<div class="d-flex justify-content-between align-items-start">
					<div class="d-flex">
						<img src="{% static 'img/location.svg' %}" alt="">
						<p style="color: #E9E9E9; width: 300px; line-height: 24px; margin-left: 10px;">г. Москва, ул. Центральная, д. 10 Самовывоз, дата: 19.09.23, 12-14 ч.</p>
					</div>
					<img src="{% static 'img/close.svg' %}" alt="">
				</div>
				<div style="background-color: #313131; border-radius: 8px; margin-top: 10px;">
					<table style="width: 100%;">
						<thead>
							<tr style="background-color: #313131;">
								<th>Артикул</th>
								<th>Название</th>
								<th>Цена</th>
								<th>Количество</th>
								<th>Итого</th>
							</tr>
						</thead>
						<tbody>
							<tr style="background-color: #313131;">
								<td></td>
                                <td></td>
                                <td></td>
                                <td></td>
								<td></td>
							</tr>
							<tr style="background-color: #313131;">
								<td style="font-weight: 500; color: #00A550;">Сумма заказа: 19 200</td>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
						</tbody>
					</table>
				</div>
				<p style="color: #E9E9E9; font-weight: 500; margin: 10px 0px 10px 10px;">Продажи</p>
				<div style="background-color: #313131; border-radius: 8px; padding: 20px 10px 0px 10px;">
					<div class="d-flex align-items-center">
						<p style="color: #E9E9E9;">22.09.23</p>
						<button class="button-2 dark" style="background-color: inherit;font-weight: 600; border-radius: 8px; padding: 10px 20px; margin: 0px 20px;">Принять</button>
						<p style="color: #E9E9E9;">Заказ принят 21.0923 в 16:31</p>
					</div>
					<p style="font-size: 12px; color: #FF0000; margin: 10px 0px;">Нажимая кнопку принять, Вы подтверждаете отгрузку в выбранную Вами дату</p>
				</div>
				<p style="color: #E9E9E9; font-weight: 500; margin: 10px 0px 10px 10px;">Бухгалтерия</p>
				<div style="background-color: #313131; border-radius: 8px; padding: 20px 10px;" class="d-flex align-items-center">
					<button style="background-color: inherit;">
						<img src="{% static 'img/clip.svg' %}" alt="">
					</button>
					<button class="button-2 dark" style="background-color: inherit; font-weight: 600; border-radius: 8px; padding: 10px 20px; margin: 0px 10px;">Отправить счет</button>
					<p style="color: #E9E9E9;">Заказ принят 21.0923 в 16:31</p>
				</div>
				<p style="color: #E9E9E9; font-weight: 500; margin: 10px 0px 10px 10px;">Склад</p>
				<div style="background-color: #313131; border-radius: 8px; padding: 20px 10px;" class="d-flex align-items-center">
					<button class="button-2 dark" style="background-color: inherit; font-weight: 600; border-radius: 8px; padding: 10px 20px; margin-right: 10px;">Заказ отгружен</button>
					<p style="color: #E9E9E9;">Заказ принят 21.0923 в 16:31</p>
				</div>
			</div>
		</div>
		<div id="popup" class="popup product-popup">
			<div class="popup-content dark" style="width: 1000px;">
				<form method="post" enctype="multipart/form-data" class="d-flex flex-column product-form">
					{% csrf_token %}
					<div class="d-flex">
						<div class="product_image_preview upload-product dark" style="min-width: 233px; min-height: 233px; text-align: center; border-radius: 16px; margin-right: 20px; position: relative; cursor: pointer;" onclick="this.querySelector('input').click()">
							<input type="file" id="product_image_input" name="photo" style="position: absolute; bottom: 0; left: 10px; z-index: -10;" hidden>
							<img class="upload-icon" src="{% static 'img/upload.png' %}" style="position: absolute; top: 20%; left: 23%;" alt="">
							<p class="select_logo dark" style="font-weight: 500; font-size: 20px; position: absolute; bottom: 10px; left: 20%;">Выбрать фото</p>
						</div>
						<div class="d-flex flex-column justify-content-between">
							<input type="text" name="category" hidden>
							<input type="text" name="store" hidden>
							<input type="text" name="articul" class="input-field dark" style="margin-top: 0px;" placeholder="Артикул (необязательно)" title="К вам поступят заявки, с четким указанием артикула товара, если Ваш товар не имеет артикула оставьте поле пустым" required>
							<input type="text" name="name" class="input-field dark" placeholder="Название" required>
							<div class="d-flex">
								<input type="number" name="amount" style="width: 70%; margin-right: 10px;" class="input-field dark" placeholder="Количество" required>
								<select name="unit" style="width: 30%;" class="input-field dark" required>
									<option disabled value="">Ед. изм</option>
									<option value="шт">шт</option>
									<option value="см">см</option>
									<option value="м2">м2</option>
								</select>
							</div>
							<div class="d-flex">
								<input type="number" name="price" style="margin-bottom: 0px; margin-right: 10px;" class="input-field dark" placeholder="Цена" required>
								<input type="number" name="remainder" style="margin-bottom: 0px;" class="input-field dark" placeholder="Остаток" required>
							</div>
						</div>
						<textarea name="description" style="margin: 0px; width: 280px; margin-left: 10px;" class="input-field dark" placeholder="Описание (необязательно)" cols="20" rows="5"></textarea>
					</div>
					<div class="button-parent" style="width: 100%; height: 30px; position: relative; margin-top: 10px;">
						
					</div>
				</form>
			</div>
		</div>

		<div id="popup" class="popup success_deal-popup">
			<div class="popup-content dark" style="width: 750px; height: 170px;">
				<div class="d-flex" style="position: relative; height: 100%;">
					<div class="d-flex flex-column justify-content-between" style="width: 420px;">
						<p class="profile-info dark" style="font-weight: 500; line-height: 24px;">Ваш магазин отправлен на модерацию, ожидайте, мы пришлем вам уведомление на почту, и в разделе “Новости” на сайте.</p>
						<button class="button-1 dark" style="font-weight: 600; border-radius: 8px; width: 200px; padding: 10px 0px;">Отлично!</button>
					</div>
					<img class="success_deal" src="{% static 'img/success_deal.png' %}" style="position: absolute; bottom: -20px; right: 20px;" alt="">
				</div>
			</div>
		</div>

		<div id="popup" class="popup store-delete-popup">
			<div class="popup-content dark" style="width: 522px;">
				<div class="d-flex flex-column">
					<p class="profile-info dark" style="line-height: 24px; margin-bottom: 10px;">Вы действительно хотите удалить ваш магазин от Маркета?</p>
					<div class="d-flex justify-content-between">
						<button style="background-color: inherit; color: #FF0000;  border: 1px solid #FF0000; font-weight: 600; border-radius: 8px; width: 200px; padding: 10px 0px;">Удалить</button>
						<button style="background-color: #00A550; color: #E9E9E9; font-weight: 600; border-radius: 8px; width: 200px; padding: 10px 0px;">Не удалять</button>
					</div>
				</div>
			</div>
		</div>

		<div id="popup" class="popup success_reg-popup" {% if success_reg and not register_form.errors %} style="display: block;" {% endif %}>
			<div class="popup-content dark" style="width: 750px; height: 170px;">
				<div class="d-flex" style="position: relative; height: 100%;">
					<div class="d-flex flex-column justify-content-between" style="width: 420px;">
						<p class="profile-info dark" style="font-weight: 500; line-height: 24px;">Ваш пароль был отправлен на почту: {{request.user.email}}</p>
						<button onclick="document.querySelector('.success_reg-popup').style.display = 'none';document.querySelector('.success_reg2-popup').style.display = 'block';" class="button-1 dark" style="font-weight: 600; border-radius: 8px; width: 200px; padding: 10px 0px;">Отлично!</button>
					</div>
					<img class="success_deal" src="{% static 'img/success_deal.png' %}" style="position: absolute; bottom: -20px; right: 20px;" alt="">
				</div>
			</div>
		</div>

		<div id="popup" class="popup success_reg2-popup">
			<div class="popup-content dark" style="width: 750px; height: 170px;">
				<div class="d-flex" style="position: relative; height: 100%;">
					<div class="d-flex flex-column justify-content-between" style="width: 420px;">
						<p class="profile-info dark" style="font-weight: 500; line-height: 24px;">Поздравляем, спасибо за доверие! Теперь зайдите в cвой профиль и заполните данные о Вашем магазине и добавьте товар</p>
						<button onclick="document.querySelector('.success_reg2-popup').style.display = 'none';" class="button-1 dark" style="font-weight: 600; border-radius: 8px; width: 200px; padding: 10px 0px;">Ok!</button>
					</div>
					<img class="success_deal" src="{% static 'img/success_deal.png' %}" style="position: absolute; bottom: -20px; right: 20px;" alt="">
				</div>
			</div>
		</div>

		<div id="popup" class="popup base_profile-popup" {% if success_save %} style="display: block;" {% endif %}>
			<div class="popup-content dark" style="width: 750px; height: 170px;">
				<div class="d-flex" style="position: relative; height: 100%;">
					<div class="d-flex flex-column justify-content-between" style="width: 420px;">
						<p class="profile-info dark" style="font-weight: 500; line-height: 24px;">Отлично, добавьте Ваш первый магазин! Для этого нажмите добавить магазин в правом верхнем углу.</p>
						<button onclick="document.querySelector('.base_profile-popup').style.display = 'none';" class="button-1 dark" style="font-weight: 600; border-radius: 8px; width: 200px; padding: 10px 0px;">Ok!</button>
					</div>
					<img class="success_deal" src="{% static 'img/success_deal.png' %}" style="position: absolute; bottom: -20px; right: 20px;" alt="">
				</div>
			</div>
		</div>
		
		<header class="navbar dark">
			<div class="container">
				<div class="navbar-links dark">
					<a {% if request.path == '/' or request.path == '/login/' %} class="active" {% endif %} href="{% url 'index' %}">Главная</a>
					<a {% if request.path == '/partner/' %} class="active" {% endif %} href="{% url 'partner' %}">Стать партнером</a>
					<a {% if request.path == '/delivery/' %} class="active" {% endif %} href="{% url 'delivery' %}">Доставка</a>
					<a {% if request.path == '/providers/' %} class="active" {% endif %} href="{% url 'providers' %}">Поставщики</a>
				</div>
				{% if request.user.is_authenticated %}
					{% if request.user.provider %}
						<div class="navbar-icons">
							<button type="button" onclick="themeChange()">
								<img class="moon-icon" src="{% static 'img/moon.svg' %}" alt="">
							</button>
						</div>
					{% else %}
						<div class="navbar-icons">
							<button type="button" onclick="themeChange()">
								<img class="moon-icon" src="{% static 'img/moon.svg' %}" alt="">
							</button>
							<button type="button" onclick="window.location.href = '/cart/'">
								<img class="cart-icon" src="{% static 'img/cart.svg' %}" alt="">
							</button>
						</div>
					{% endif %}
				{% else %}
					<div class="navbar-icons">
						<button type="button" onclick="themeChange()">
							<img class="moon-icon" src="{% static 'img/moon.svg' %}" alt="">
						</button>
						<button type="button" onclick="document.querySelector('.auth-popup').style.display = 'block';">
							<img class="user-icon" src="{% static 'img/user.svg' %}" alt="">
						</button>
					</div>
				{% endif %}
			</div>
		</header>
	
		<div class="sidebar dark">
			<div class="d-flex justify-content-around align-items-center sidebar__logo dark">
				<img class="logo" src="{% static 'img/logo.svg' %}" alt="">
				<p style="font-size: 24px; font-weight: 600; color: #E9E9E9;">TODOMARKET</p>
			</div>
			<br>
			<ul class="sidebar__links">
				<li class="sidebar__link dark {% if request.path == '/profile/' %} sidebar__link-active {% endif %}">
					<div>
						<img class="profile-icon" src="{% if request.path == '/profile/' %} {% static 'img/profile-active.svg' %} {% else %} {% static 'img/profile.svg' %} {% endif %}" alt="">
						<a href="{% if request.user.provider %}{% url 'profile' %}{% else %}{% url 'partner' %}{% endif %}">Мой профиль</a>
					</div>
				</li>
				{% if request.user.buyer %}
				<li class="sidebar__link dark {% if request.path == '/archive/' %} sidebar__link-active {% endif %}">
					<div>
						<img class="orders-icon" src="{% if request.path == '/orders/' %} {% static 'img/orders-active.svg' %} {% else %} {% static 'img/orders.svg' %} {% endif %}" alt="">
						<a href="">Мои заказы</a>
					</div>
				</li>
				{% endif %}
	
				<li class="sidebar__link dark {% if request.path == '/archive/' %} sidebar__link-active {% endif %}">
					<div>
						<img class="works-icon" src="{% if request.path == '/works/' %} {% static 'img/works-active.svg' %} {% else %} {% static 'img/works.svg' %} {% endif %}" alt="">
						<a href="">Заказы в работе</a>
					</div>
				</li>
	
				<li class="sidebar__link dark {% if request.path == '/archive/' %} sidebar__link-active {% endif %}">
					<div>
						<img class="archive-icon" src="{% if request.path == '/archive/' %} {% static 'img/store-active.svg' %} {% else %} {% static 'img/archive.svg' %} {% endif %}" alt="">
						<a href="">Архив</a>
					</div>
				</li>
	
				<li class="sidebar__link dark">
					<div>
						<img class="help-icon" src="{% static 'img/help.svg' %}" alt="">
						<a href="https://t.me/todotodo_admin">Помощь</a>
					</div>
				</li>
	
				<br><br><br><br><br>
				<li class="sidebar__link dark" style="padding: 0px; margin: 0px;">
					<a href="https://t.me/chattodotodo_bot">Другие проекты</a>
				</li>
				<li class="sidebar__link dark" style="padding: 0px; margin: 0px;">
					<a href="https://t.me/todotodo_admin">Вопрос-ответ</a>
				</li>
				<li class="sidebar__link dark" style="padding: 0px; margin: 0px; position: relative;">
					<a href="{% url 'news' %}">Новости</a>
					<p class="news-count dark">{{news_length}}</p>
				</li>
				{% if request.user.is_authenticated %}
					<li class="sidebar__link dark" style="padding: 0px; margin: 0px;">
						<a href="{% url 'logout_core_view' %}">Выйти</a>
					</li>
				{% endif %}
			</ul>
		</div>
	
		<div class="content">
			<div class="container">
				{% block content %}
        
                {% endblock content %}
			</div>
		</div>
	
		<footer class="footer">
			<p class="footer__title dark" style="padding-left: 5px;">Реклама</p>
			<div class="d-flex footer__content dark">
				<img src="{{ads.img.url}}" width="56" height="56" alt="">
				<div class="d-flex flex-column justify-content-around marquee">
					<p class="footer__content-title dark">{{ads.title}}</p>
					<p id="marqueeText" class="dark">{{ads.text}}</p>
				</div>
			</div>
		</footer>
		<div id="snackbar" class="dark">Товар добавлен в корзину</div>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
	<script>

		function themeChange(){
			if (localStorage.getItem('theme') == 'light') {
				localStorage.removeItem("theme")
				const lights = document.querySelectorAll(".light")
				for (let light of lights) {
					light.classList.remove("light")
					light.classList.add("dark")
				}

				document.querySelector('.profile-icon').src = '/static/img/profile.svg';
				try {
					document.querySelector('.orders-icon').src = '/static/img/orders.svg';
				} catch (_) {
					console.log("orders not fount")
				}
				document.querySelector('.works-icon').src = '/static/img/works.svg';
				document.querySelector('.archive-icon').src = '/static/img/archive.svg';
				document.querySelector('.help-icon').src = '/static/img/help.svg';

				try {
					document.querySelector('.moon-icon').src = '/static/img/moon.svg';
				} catch (_) {
					console.log("moon not found")
				}
				try {
					document.querySelector('.user-icon').src = '/static/img/user.svg';
				} catch (_) {
					console.log("user not found")
				}
				try {
					document.querySelector('.cart-icon').src = '/static/img/cart.svg';
				} catch (_) {
					console.log("cart not found")
				}

				try {
					document.querySelector('.target-icon').src = '/static/img/target.svg';
				} catch (_) {
					console.log("target not found")
				}

				try {
					document.querySelector('.earth-icon').src = '/static/img/earth.svg';
				} catch (_) {
					console.log("earth not found")
				}

				try {
					document.querySelector('.search-icon').src = '/static/img/search.svg';
				} catch (_) {
					console.log("search not found")
				}

				try {
					document.querySelector('.truck-icon').src = '/static/img/truck.svg';
				} catch (_) {
					console.log("truck not found")
				}

				try {
					document.querySelector('.star-icon').src = '/static/img/star.svg';
				} catch (_) {
					console.log("star not found")
				}

				try {
					for (const deals of document.querySelectorAll('.success_deal')) {
						deals.src = '/static/img/success_deal.png';
					}
				} catch (_) {
					console.log("deals not found")
				}

				try {
					for (const close of document.querySelectorAll('.close-icon')) {
						close.src = '/static/img/close.svg';
					}
				} catch (_) {
					console.log("close not found")
				}

				try {
					for (const upload of document.querySelectorAll('.upload-icon')) {
						upload.src = '/static/img/upload.png';
					}
				} catch (_) {
					console.log("upload not found")
				}

				try {
					document.querySelector('.signup-img').src = '/static/img/signup.png';
				} catch (_) {
					console.log("signup not found")
				}

				try {
					document.querySelector('.delivery').src = '/static/img/delivery.png';
				} catch (_) {
					console.log("delivery not found")
				}

				document.querySelector('.logo').src = '/static/img/logo.svg';


			} else {
				const darks = document.querySelectorAll(".dark")
				for (let dark of darks) {
					dark.classList.remove("dark")
					dark.classList.add("light")
				}

				document.querySelector('.profile-icon').src = '/static/img/light-profile.svg';
				try {
					document.querySelector('.orders-icon').src = '/static/img/light-orders.svg';
				} catch (_) {
					console.log("orders not found")
				}
				document.querySelector('.works-icon').src = '/static/img/light-works.svg';
				document.querySelector('.archive-icon').src = '/static/img/light-archive.svg';
				document.querySelector('.help-icon').src = '/static/img/light-help.svg';

				try {
					document.querySelector('.moon-icon').src = '/static/img/light-moon.svg';
				} catch (_) {
					console.log("moon not found")
				}
				try {
					document.querySelector('.user-icon').src = '/static/img/light-user.svg';
				} catch (_) {
					console.log("user not found")
				}
				try {
					document.querySelector('.cart-icon').src = '/static/img/light-cart.svg';
				} catch (_) {
					console.log("cart not found")
				}

				try {
					document.querySelector('.target-icon').src = '/static/img/light-target.svg';
				} catch (_) {
					console.log("target not found")
				}

				try {
					document.querySelector('.earth-icon').src = '/static/img/light-earth.svg';
				} catch (_) {
					console.log("earth not found")
				}

				try {
					document.querySelector('.search-icon').src = '/static/img/light-search.svg';
				} catch (_) {
					console.log("search not found")
				}

				try {
					document.querySelector('.truck-icon').src = '/static/img/light-truck.svg';
				} catch (_) {
					console.log("truck not found")
				}

				try {
					document.querySelector('.star-icon').src = '/static/img/light-star.svg';
				} catch (_) {
					console.log("star not found")
				}

				try {
					for (const deals of document.querySelectorAll('.success_deal')) {
						deals.src = '/static/img/success_deal_light.png';
					}
				} catch (_) {
					console.log("deals not found")
				}

				try {
					for (const close of document.querySelectorAll('.close-icon')) {
						close.src = '/static/img/light-close.svg';
					}
				} catch (_) {
					console.log("close not found")
				}

				try {
					for (const upload of document.querySelectorAll('.upload-icon')) {
						upload.src = '/static/img/light-upload.png';
					}
				} catch (_) {
					console.log("upload not found")
				}

				try {
					document.querySelector('.signup-img').src = '/static/img/light-signup.png';
				} catch (_) {
					console.log("signup not found")
				}

				try {
					document.querySelector('.delivery').src = '/static/img/delivery-light.png';
				} catch (_) {
					console.log("delivery not found")
				}

				document.querySelector('.logo').src = '/static/img/logo-light.png';

				localStorage.setItem("theme", "light")

			}
		}

		document.addEventListener('DOMContentLoaded', function () {
			
			if (localStorage.getItem('theme') == 'light') {
				localStorage.removeItem("theme")
				const darks = document.querySelectorAll(".dark")
				for (let dark of darks) {
					dark.classList.remove("dark")
					dark.classList.add("light")
				}

				document.querySelector('.profile-icon').src = '/static/img/light-profile.svg';
				try {
					document.querySelector('.orders-icon').src = '/static/img/light-orders.svg';
				} catch (_) {
					console.log("orders not found")
				}
				document.querySelector('.works-icon').src = '/static/img/light-works.svg';
				document.querySelector('.archive-icon').src = '/static/img/light-archive.svg';
				document.querySelector('.help-icon').src = '/static/img/light-help.svg';
				try {
					document.querySelector('.moon-icon').src = '/static/img/light-moon.svg';
				} catch (_) {
					console.log("moon not found")
				}
				try {
					document.querySelector('.user-icon').src = '/static/img/light-user.svg';
				} catch (_) {
					console.log("user not found")
				}
				try {
					document.querySelector('.cart-icon').src = '/static/img/light-cart.svg';
				} catch (_) {
					console.log("cart not found")
				}

				try {
					document.querySelector('.target-icon').src = '/static/img/light-target.svg';
				} catch (_) {
					console.log("target not found")
				}

				try {
					document.querySelector('.earth-icon').src = '/static/img/light-earth.svg';
				} catch (_) {
					console.log("earth not found")
				}

				try {
					document.querySelector('.search-icon').src = '/static/img/light-search.svg';
				} catch (_) {
					console.log("search not found")
				}

				try {
					document.querySelector('.truck-icon').src = '/static/img/light-truck.svg';
				} catch (_) {
					console.log("truck not found")
				}

				try {
					document.querySelector('.star-icon').src = '/static/img/light-star.svg';
				} catch (_) {
					console.log("star not found")
				}

				try {
					for (const deals of document.querySelectorAll('.success_deal')) {
						deals.src = '/static/img/success_deal_light.png';
					}
				} catch (_) {
					console.log("deals not found")
				}

				try {
					for (const close of document.querySelectorAll('.close-icon')) {
						close.src = '/static/img/light-close.svg';
					}
				} catch (_) {
					console.log("close not found")
				}

				try {
					for (const upload of document.querySelectorAll('.upload-icon')) {
						upload.src = '/static/img/light-upload.png';
					}
				} catch (_) {
					console.log("upload not found")
				}

				try {
					document.querySelector('.signup-img').src = '/static/img/light-signup.png';
				} catch (_) {
					console.log("signup not found")
				}

				try {
					document.querySelector('.delivery').src = '/static/img/delivery-light.png';
				} catch (_) {
					console.log("delivery not found")
				}

				document.querySelector('.logo').src = '/static/img/logo-light.png';

				localStorage.setItem("theme", "light")
			}

		});

		window.addEventListener('click', function(event) {
			let popups = document.querySelectorAll('#popup');
			for (let popup of popups) {
				if (event.target == popup) {
					popup.style.display = 'none';
				}
			}
			
		});

		function minus(element){
			i = element.nextElementSibling;
			if (i.value != 1){
				i.value = Number(i.value) - 1
			}
		}
		
		function plus(element){
			i = element.previousElementSibling;
			i.value = Number(i.value) + 1
    	}

		function openTab(element) {
			if (element.textContent == 'Регистрация') {
				element.classList.add("active")
				if (localStorage.getItem('theme') == 'light') {
					element.style.backgroundColor = "#2094AD"
				} else {
					element.style.backgroundColor = "#00A550"
				}
				element.nextElementSibling.classList.remove("active")
				element.nextElementSibling.style.backgroundColor = "inherit"
				document.querySelector(".signup").classList.add("d-flex")
				document.querySelector(".signup").classList.add("flex-column")
				document.querySelector(".signin").classList.remove("d-flex")
				document.querySelector(".signin").classList.remove("flex-column")
				document.querySelector('.signin').style.display = 'none';
			} else {
				element.classList.add("active")
				if (localStorage.getItem('theme') == 'light') {
					element.style.backgroundColor = "#2094AD"
				} else {
					element.style.backgroundColor = "#00A550"
				}
				element.previousElementSibling.classList.remove("active")
				element.previousElementSibling.style.backgroundColor = "inherit"
				document.querySelector(".signin").classList.add("d-flex")
				document.querySelector(".signin").classList.add("flex-column")
				document.querySelector(".signup").classList.remove("d-flex")
				document.querySelector(".signup").classList.remove("flex-column")
				document.querySelector('.signup').style.display = 'none';
			}
		}

		function toggleAccordion(element) {
			element.parentNode.classList.toggle("active");
			
			var accordionContent = element.nextElementSibling;
			var triangle = element.querySelector(".triangle")
			if (triangle.classList.contains("triangle-bottom")) {
				triangle.classList.remove("triangle-bottom")
				triangle.classList.add("triangle-top")
			} else {
				triangle.classList.remove("triangle-top")
				triangle.classList.add("triangle-bottom")
			}
		}

		function createStore(element) {
			element.style.display = 'none';
			let template = document.getElementById('template');
			let targetBlock = document.querySelector('.main-profile');

			let clonedBlock = template.querySelector('.store-info').cloneNode(true);

			targetBlock.parentNode.insertBefore(clonedBlock, targetBlock.nextSibling);
		}

		function openProduct(element, store, isCreate, category, name, articul, amount, unit, remainder, image, description, id, price){
			const popup_product = document.querySelector(".product-popup")
			const button_parent = popup_product.querySelector(".button-parent")
			for (const button of button_parent.querySelectorAll("button")) {
				button.remove()
			}
			if (isCreate) {
				for (const input of popup_product.querySelectorAll("input")){
					if (input.name == "category") {
						input.value = category
					} else if (input.name == "store"){
						input.value = store
					} else {
						input.value = ""
					}
				}

				productPreview.style.background = `none`;
				if (localStorage.getItem('theme') == 'light') {
					productPreview.style.backgroundColor = `#F8F8F8`;
				} else {
					productPreview.style.backgroundColor = `#313131`;
				}

				productPreview.querySelector("img").style.display = 'block';

				popup_product.querySelector("select").value = ""
				popup_product.querySelector("textarea").value = ""
				button_parent.insertAdjacentHTML("afterbegin", `<button type="button" class="button-1 ${localStorage.getItem('theme') == 'light' ? 'light' : 'dark'}" onclick="createProduct(${category}, ${store})" style="font-weight: 600; border-radius: 8px; padding: 10px 0px; width: 25%; position: absolute; right: 0px;">Создать</button>`)
			} else {
				const name_input = popup_product.querySelector("input[name='name']")
				const articul_input = popup_product.querySelector("input[name='articul']")
				const amount_input = popup_product.querySelector("input[name='amount']")
				const remainder_input = popup_product.querySelector("input[name='remainder']")
				const price_input = popup_product.querySelector("input[name='price']")
				const description_input = popup_product.querySelector("textarea")
				const select_unit = popup_product.querySelector("select")

				productPreview.style.background = `url("${image}") 0 0/100% 100% no-repeat`;
				productPreview.querySelector("img").style.display = 'none';
				

				name_input.value = name
				articul_input.value = articul
				amount_input.value = amount
				remainder_input.value = remainder
				description_input.value = description
				select_unit.value = unit
				price_input.value = price

				button_parent.insertAdjacentHTML("afterbegin", `<button type="button" class="button-1 ${localStorage.getItem('theme') == 'light' ? 'light' : 'dark'}" onclick="updateProduct(${store}, ${category}, ${id})" style="font-weight: 600; border-radius: 8px; padding: 10px 0px; width: 25%; position: absolute; right: 0px;">Сохранить</button>`)
			}
			popup_product.style.display = 'block';
		}

		function createProduct(category_id, store_id){
			const product_form = document.querySelector('.product-form')
			let formData = new FormData(product_form);
			let xhr = new XMLHttpRequest();
			xhr.open('POST', '/create_product/');
			xhr.responseType = 'json';
			xhr.onload = function() {
				if (xhr.status == 200) {
					const target_element = document.querySelector(`.store_${store_id}_${category_id}`)
					target_element.insertAdjacentHTML("afterbegin", `<div class="d-flex flex-column swiper-slide" style="width: 256px; margin-right: 20px;">
					<div style="position: relative;">
						<img src="${xhr.response["image"]}" width="260" height="260" style="border-radius: 8px;" onclick="openProduct(this, '${xhr.response["store"]}', false, '${xhr.response["category"]}', '${xhr.response["name"]}', '${xhr.response["articul"]}', '${xhr.response["amount"]}', '${xhr.response["unit"]}', '${xhr.response["remainder"]}', '${xhr.response["image"]}', '${xhr.response["description"]}', '${xhr.response["id"]}', '${xhr.response["price"]}')" alt="">
						<img src="{% static 'img/close.svg' %}" onclick="deleteProduct(this, '${xhr.response["id"]}')" style="position: absolute; top: 10px; right: 10px;" alt="">
						<p class="product-subtitle" style="line-height: 24px;">${xhr.response["name"]}, ${xhr.response["articul"]} <span style="font-size: 12px; color: #616161;">${xhr.response["amount"]} ${xhr.response["unit"]}</span></p>
					</div>
				</div>`)
				document.querySelector(".product-popup").style.display = "none"
				}
			};
			xhr.send(formData);
		}

		function updateProduct(store_id, category_id, id){
			let formData = new FormData(document.querySelector('.product-form'));
			let xhr = new XMLHttpRequest();
			xhr.open('POST', `/update_product/${id}/`);
			xhr.responseType = 'json';
			xhr.onload = function() {
				if (xhr.status == 200) {
					const target_element = document.querySelector(`.store_${store_id}_${category_id} .product_${id}`)
					for (const div of target_element.querySelectorAll("div")){
						div.remove()
					}
					target_element.insertAdjacentHTML("afterbegin", `<div style="position: relative;">
						<img src="${xhr.response["image"]}" width="260" height="260" style="border-radius: 8px;" onclick="openProduct(this, '${xhr.response["store"]}', false, '${xhr.response["category"]}', '${xhr.response["name"]}', '${xhr.response["articul"]}', '${xhr.response["amount"]}', '${xhr.response["unit"]}', '${xhr.response["remainder"]}', '${xhr.response["image"]}', '${xhr.response["description"]}', '${xhr.response["id"]}', '${xhr.response["price"]}')" alt="">
						<img src="{% static 'img/close.svg' %}" onclick="deleteProduct(this, '${xhr.response["id"]}')" style="position: absolute; top: 10px; right: 10px;" alt="">
						<p class="product-subtitle" style="line-height: 24px;">${xhr.response["name"]}, ${xhr.response["articul"]} <span style="font-size: 12px; color: #616161;">${xhr.response["amount"]} ${xhr.response["unit"]}</span></p>
					</div>`)
				document.querySelector(".product-popup").style.display = "none"
				}
			};
			xhr.send(formData);
		}

		function deleteProduct(element, id){
			let xhr = new XMLHttpRequest();
			xhr.open('GET', `/delete_product/${id}/`);
			xhr.onload = function() {
				if (xhr.status == 200) {
					element.parentNode.parentNode.remove()
				}
			};
			xhr.send();
		}

		function showSnack() {
			var x = document.getElementById("snackbar");
			x.classList.add("show")
			setTimeout(function(){ x.className = x.classList.remove("show"); }, 3000);
		}


		function addToCart(id, form){
			let formData = new FormData(form);
			let xhr = new XMLHttpRequest();
			xhr.open('POST', `/addtoCart/${id}/`);
			xhr.responseType = 'json';
			xhr.onload = function() {
				if (xhr.status == 200) {
					if (xhr.response['success']) {
						showSnack()
					}
				}
			};
			xhr.send(formData);
		}

	</script>
	{% block script %}{% endblock script %}
</body>

</html>